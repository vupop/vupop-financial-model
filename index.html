<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Vupop Financial Model - Interactive financial analysis and projection tool">
    <meta name="theme-color" content="#000000">
    <title>Vupop Financial Model - Interactive</title>
    <style>
        :root {
            --yellow: #fff700;
            --black: #111111;
            --white: #fff;
            --gray: #222;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--black);
            color: var(--white);
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background: var(--black);
            border-radius: 24px;
            padding: 35px 20px 20px 20px;
            text-align: center;
            margin-bottom: 35px;
            border: 2px solid var(--yellow);
            position: relative;
        }
        .header .logo {
            display: block;
            margin: 0 auto 20px auto;
            max-width: 220px;
            height: auto;
        }
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: var(--yellow);
            font-weight: 900;
            letter-spacing: 2px;
        }
        .header p {
            color: var(--white);
            font-size: 1.1em;
        }
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        .controls-panel, .results-panel {
            background: var(--gray);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            border: 2px solid var(--yellow);
        }
        .section-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 20px;
            color: var(--yellow);
            border-bottom: 2px solid var(--yellow);
            padding-bottom: 10px;
        }
        .input-group {
            margin-bottom: 20px;
        }
        .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--yellow);
        }
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--yellow);
            border-radius: 10px;
            font-size: 16px;
            background: var(--black);
            color: var(--white);
            transition: all 0.3s ease;
        }
        .input-group input:focus {
            border-color: var(--yellow);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 247, 0, 0.2);
        }
        .input-group input:hover {
            border-color: var(--white);
        }
        .button {
            background: var(--yellow);
            color: var(--black);
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin: 12px 0;
            position: relative;
            overflow: hidden;
            letter-spacing: 1px;
        }
        .button:hover {
            background-color: #555;
            transform: translateY(-2px);
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .metric-card {
            background: var(--black);
            border: 2px solid var(--yellow);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            color: var(--yellow);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .metric-card h3 {
            font-size: 1em;
            color: var(--yellow);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .metric-value {
            font-size: 2.2em;
            font-weight: bold;
            color: var(--white);
        }
        .metric-subtitle {
            font-size: 0.8em;
            color: var(--yellow);
            margin-top: 5px;
        }
        .chart-container {
            background: var(--black);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            border: 2px solid var(--yellow);
        }
        .financial-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 25px 0;
            background: var(--black);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            color: var(--white);
        }
        .financial-table th {
            background: var(--yellow);
            color: var(--black);
            padding: 18px;
            text-align: left;
            font-weight: 700;
            font-size: 0.95em;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        .financial-table td {
            padding: 16px 18px;
            border-bottom: 1px solid var(--yellow);
            font-size: 0.95em;
            transition: all 0.3s ease;
        }
        .financial-table tr:hover td {
            background: #222200;
        }
        .financial-table tr:last-child td {
            border-bottom: none;
        }
        .exit-highlight {
            background: var(--yellow);
            color: var(--black);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
            font-weight: 700;
        }
        .exit-highlight h3 {
            margin: 0 0 10px 0;
            font-size: 1.5em;
            color: var(--black);
        }
        @media (max-width: 900px) {
            .dashboard {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }
        /* Password Overlay */
        .password-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.98);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .password-box {
            background: var(--black);
            border: 2px solid var(--yellow);
            border-radius: 16px;
            padding: 40px 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.6);
            text-align: center;
            min-width: 320px;
        }
        .password-box label {
            color: var(--yellow);
            font-size: 1.2em;
            font-weight: 700;
            margin-bottom: 16px;
            display: block;
        }
        .password-box input[type='password'] {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--yellow);
            border-radius: 8px;
            font-size: 1.1em;
            background: var(--black);
            color: var(--white);
            margin-bottom: 18px;
        }
        .password-box button {
            background: var(--yellow);
            color: var(--black);
            border: none;
            padding: 10px 24px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: background 0.2s;
        }
        .password-box button:hover {
            background: var(--white);
        }
        .password-error {
            color: #ff3333;
            margin-bottom: 10px;
            font-weight: 600;
        }
        .scenario-section {
            background: var(--gray);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            border: 2px solid var(--yellow);
        }
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .kpi-card {
            background: var(--black);
            border: 2px solid var(--yellow);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            color: var(--yellow);
        }
        .kpi-card h4 {
            color: var(--yellow);
            margin-bottom: 10px;
            font-size: 0.9em;
            text-transform: uppercase;
        }
        .kpi-value {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--white);
        }
        /* Tooltip styles */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--black);
            color: var(--white);
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            border: 1px solid var(--yellow);
            font-size: 0.9em;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* Progress indicator */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: var(--gray);
            border-radius: 2px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: var(--yellow);
            transition: width 0.3s ease;
        }

        /* Keyboard shortcut hints */
        .shortcut-hint {
            font-size: 0.8em;
            color: var(--yellow);
            opacity: 0.7;
            margin-left: 8px;
        }

        /* Improved walkthrough navigation */
        .walkthrough-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding: 10px;
            background: var(--gray);
            border-radius: 10px;
        }

        .walkthrough-nav button {
            background: var(--yellow);
            color: var(--black);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .walkthrough-nav button:hover {
            background: var(--white);
        }

        .walkthrough-nav button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Quick navigation menu */
        .quick-nav {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--gray);
            padding: 10px;
            border-radius: 10px;
            border: 1px solid var(--yellow);
            z-index: 100;
        }

        .quick-nav button {
            display: block;
            width: 100%;
            padding: 8px 12px;
            margin: 5px 0;
            background: var(--black);
            color: var(--yellow);
            border: 1px solid var(--yellow);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quick-nav button:hover {
            background: var(--yellow);
            color: var(--black);
        }
        .sidebar {
            width: 70px;
            background: #181818;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 16px 0;
            border-right: 2px solid var(--yellow);
            min-height: 100vh;
            z-index: 10;
        }
        .sidebar-logo {
            margin-bottom: 24px;
        }
        .sidebar-nav button {
            background: none;
            border: none;
            color: var(--yellow);
            font-size: 1.7em;
            margin: 18px 0;
            cursor: pointer;
            transition: color 0.2s;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .sidebar-nav button:hover {
            color: var(--white);
        }
        .main-content {
            padding: 24px;
        }
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        .dashboard-header h1 {
            font-size: 2em;
            color: var(--yellow);
        }
        .header-actions button {
            background: var(--yellow);
            color: var(--black);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .header-actions button:hover {
            background: var(--white);
        }
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }
        .card {
            background: var(--gray);
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1.5px solid var(--yellow);
            padding: 22px 18px 18px 18px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            min-height: 120px;
            grid-column: span 1;
        }
        .metric-card h3 {
            font-size: 1.1em;
            color: var(--yellow);
            margin-bottom: 8px;
            font-weight: 700;
        }
        .metric-value {
            font-size: 2.1em;
            font-weight: bold;
            color: var(--white);
        }
        .metric-subtitle {
            font-size: 0.9em;
            color: var(--yellow);
            margin-top: 4px;
        }
        .chart-card {
            background: var(--gray);
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1.5px solid var(--yellow);
            padding: 22px 18px 18px 18px;
            min-height: 320px;
            grid-column: span 3;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .kpi-legend {
            margin-top: 10px;
            display: flex;
            gap: 18px;
            flex-wrap: wrap;
        }
        .kpi-legend-item {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 0.98em;
            font-weight: 600;
            color: var(--yellow);
            opacity: 0.85;
            margin-right: 12px;
            user-select: none;
        }
        .kpi-legend-color {
            width: 18px;
            height: 4px;
            border-radius: 2px;
            margin-right: 7px;
            display: inline-block;
        }
        .kpi-legend-item.inactive {
            opacity: 0.4;
            text-decoration: line-through;
        }
        /* Assumptions Panel (pop-out) */
        .assumptions-panel {
            display: none; /* Hidden by default */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 1000;
            justify-content: center;
            align-items: flex-start;
            padding-top: 2vh; /* Even closer to top */
        }
        .assumptions-content {
            max-width: 1200px; /* Wider for compact 3-column */
            padding: 15px 25px;
        }
        .assumptions-panel .controls-panel {
            display: flex;
            justify-content: space-between;
            gap: 25px;
        }

        .assumptions-panel .assumptions-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        #assumptionsInputs {
            border: none !important; /* remove diagnostic style */
        }
        .tooltip-text {
            width: 220px;
            text-align: left;
            font-size: 0.85em;
        }

        /* Updated Dashboard Layout */
        .chart-card {
            grid-column: span 2 !important;
        }
        .table-card {
            grid-column: span 2;
        }
        .card-grid {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }
        .kpi-summary-card {
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 15px;
        }
        .kpi-item {
            font-size: 1.1em;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="passwordOverlay" class="password-overlay">
        <form class="password-box" onsubmit="return checkPassword(event)">
            <label for="passwordInput">Enter Password to Access</label>
            <input type="password" id="passwordInput" autocomplete="off" autofocus required />
            <div id="passwordError" class="password-error" style="display:none;">Incorrect password. Please try again.</div>
            <button type="submit">Unlock</button>
        </form>
    </div>
    <div id="mainContent" class="main-content" style="display:none;">
        <div class="dashboard-header">
            <h1>Vupop Financial Dashboard</h1>
            <div class="header-actions">
                <button id="adjustAssumptionsBtn" class="button">Adjust Assumptions</button>
            </div>
        </div>

        <div class="card-grid">
            <div class="card metric-card" data-tooltip="Risk-adjusted value based on scenario probabilities.">
                <h3>Exit Potential</h3>
                <div class="metric-value" id="exitPotential">£81.2M</div>
            </div>
            <div class="card metric-card" data-tooltip="Projected annual revenue for Year 4 in the base case scenario.">
                <h3>Annual Revenue (Y4)</h3>
                <div class="metric-value" id="annualRevenue">£8.1M</div>
            </div>
            <div class="card metric-card" data-tooltip="Projected Monthly Active Users for Year 4.">
                <h3>Target MAU (Y4)</h3>
                <div class="metric-value" id="targetMau">500K</div>
            </div>
            <div class="card metric-card" data-tooltip="Customer Acquisition Cost for Year 4.">
                <h3>CAC (Y4)</h3>
                <div class="metric-value" id="kpi-cac">£4.00</div>
            </div>

            <div class="card chart-card" style="grid-column: span 3;">
                <h3 class="section-title">Key Financials & Growth Over Time</h3>
                <canvas id="kpiLineChart"></canvas>
            </div>

            <div class="card kpi-summary-card" style="grid-column: span 1;">
                <h3 class="section-title">KPIs (Y4)</h3>
                <div class="kpi-item"><strong>ARPU:</strong> <span id="kpi-arpu">£1.67</span></div>
                <div class="kpi-item"><strong>B2B LTV:</strong> <span id="kpi-ltv">£110K</span></div>
                <div class="kpi-item"><strong>LTV/CAC Ratio:</strong> <span id="kpi-ltv-cac">49:1</span></div>
                <div class="kpi-item"><strong>Retention:</strong> <span id="kpi-retention">92%</span></div>
            </div>
            
            <div id="kpiLegendContainer" class="card" style="grid-column: span 4; padding: 10px 15px;">
                <div id="kpiLegend" class="kpi-legend"></div>
            </div>
            <div class="card table-card" style="grid-column: span 4;">
                <h3 class="section-title">Market Comparables (Media/Social Media)</h3>
                <p style="margin-bottom: 15px; opacity: 0.9; font-size: 0.95em;">
                    This table benchmarks Vupop against recent media and social media transactions. It highlights that niche platforms with unique content (like Vupop's sports focus) often command premium valuations per user, justifying our target valuation with a smaller, more engaged user base compared to generic social platforms.
                </p>
                <table class="financial-table">
                    <thead><tr><th>Company</th><th>Year</th><th>MAU (M)</th><th>Valuation (£M)</th><th>Value per MAU (£)</th></tr></thead>
                    <tbody>
                        <tr><td>Truth Social</td><td>2024</td><td>5</td><td>£4,680</td><td>£936</td></tr>
                        <tr><td>Snapchat</td><td>2017</td><td>190</td><td>£18,720</td><td>£99</td></tr>
                        <tr><td>Discord</td><td>2023</td><td>154</td><td>£11,700</td><td>£76</td></tr>
                        <tr><td>Pinterest</td><td>2019</td><td>400</td><td>£7,800</td><td>£20</td></tr>
                        <tr><td>Reddit</td><td>2024</td><td>430</td><td>£5,070</td><td>£12</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="card table-card" style="grid-column: span 2;">
                <h3 class="section-title">Vupop Growth Projections</h3>
                <table class="financial-table">
                    <thead><tr><th>Milestone</th><th>MAU</th><th>Valuation</th><th>Timeline</th></tr></thead>
                    <tbody>
                        <tr><td>Early Traction</td><td>50K</td><td>£16M</td><td>Year 1</td></tr>
                        <tr><td>Scale Proof</td><td>250K</td><td>£80M</td><td>Year 2</td></tr>
                        <tr style="background:#222; color:var(--yellow)"><td>Strategic Exit</td><td>313K</td><td>£100M</td><td>Year 3-4</td></tr>
                        <tr><td>Major Platform</td><td>2M</td><td>£638M</td><td>Year 5+</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="card table-card" style="grid-column: span 1;">
                <h3 class="section-title">Return Scenarios</h3>
                <table class="financial-table">
                    <thead><tr><th>Scenario</th><th>Multiple</th><th>IRR</th></tr></thead>
                    <tbody>
                        <tr><td>Conservative</td><td>22.2x</td><td>122%</td></tr>
                        <tr><td>Base Case</td><td>31.1x</td><td>154%</td></tr>
                        <tr><td>Optimistic</td><td>44.4x</td><td>172%</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div id="assumptionsPanel" class="assumptions-panel">
        <div class="assumptions-content">
            <button id="closeAssumptions" class="close-btn">&times;</button>
            <h2 class="section-title">Adjust Key Assumptions</h2>
            <div id="assumptionsInputs">
                <div class="controls-panel">
                    <div class="assumptions-column">
                        <h4 class="section-title">User Growth</h4>
                        <div class="input-group"><label for="startingMAU">Starting MAU</label><input type="number" id="startingMAU" value="1000"></div>
                        <div class="input-group"><label for="mau1">Year 1 Target MAU</label><input type="number" id="mau1" value="50000"></div>
                        <div class="input-group"><label for="mau2">Year 2 Target MAU</label><input type="number" id="mau2" value="150000"></div>
                        <div class="input-group"><label for="mau3">Year 3 Target MAU</label><input type="number" id="mau3" value="313000"></div>
                        <div class="input-group"><label for="mau4">Year 4 Target MAU</label><input type="number" id="mau4" value="500000"></div>
                        <div class="input-group"><label for="mau5">Year 5 Target MAU</label><input type="number" id="mau5" value="750000"></div>
                    </div>
                    <div class="assumptions-column">
                        <h4 class="section-title">B2C & B2B Pricing</h4>
                        <div class="input-group"><label for="premiumPrice">Premium Subscription Price (£)</label><input type="number" id="premiumPrice" value="0.99"></div>
                        <div class="input-group"><label for="adoptionRate">Premium Adoption Rate (%)</label><input type="number" id="adoptionRate" value="10"></div>
                        <div class="input-group"><label for="adRevenue">Ad Revenue per User (£)</label><input type="number" id="adRevenue" value="0.45"></div>
                        <div class="input-group"><label for="affiliateRate">Affiliate Commission Rate (%)</label><input type="number" id="affiliateRate" value="5.00"></div>
                        <div class="input-group"><label for="socialTierPrice">Social Tier Price (£)</label><input type="number" id="socialTierPrice" value="999"></div>
                        <div class="input-group"><label for="broadcastTierPrice">Broadcast Tier Price (£)</label><input type="number" id="broadcastTierPrice" value="3499"></div>
                        <div class="input-group"><label for="broadcastPlusTierPrice">Broadcast+ Tier Price (£)</label><input type="number" id="broadcastPlusTierPrice" value="4997"></div>
                    </div>
                    <div class="assumptions-column">
                        <h4 class="section-title">Costs & Scenarios</h4>
                        <div class="input-group"><label for="marketingSpend1">Year 1 Marketing Spend (£)</label><input type="number" id="marketingSpend1" value="200000"></div>
                        <div class="input-group"><label for="marketingSpend2">Year 2 Marketing Spend (£)</label><input type="number" id="marketingSpend2" value="400000"></div>
                        <div class="input-group"><label for="marketingSpend3">Year 3 Marketing Spend (£)</label><input type="number" id="marketingSpend3" value="600000"></div>
                        <div class="input-group"><label for="marketingSpend4">Year 4 Marketing Spend (£)</label><input type="number" id="marketingSpend4" value="800000"></div>
                        <div class="input-group"><label for="marketingSpend5">Year 5 Marketing Spend (£)</label><input type="number" id="marketingSpend5" value="1000000"></div>
                        <div class="input-group"><label for="probConservative">Conservative Scenario Probability (%)</label><input type="number" id="probConservative" value="30"></div>
                        <div class="input-group"><label for="probBase">Base Case Scenario Probability (%)</label><input type="number" id="probBase" value="50"></div>
                        <div class="input-group"><label for="probOptimistic">Optimistic Scenario Probability (%)</label><input type="number" id="probOptimistic" value="20"></div>
                    </div>
                </div>
            </div>
            <button id="updateButton">Update Dashboard</button>
        </div>
    </div>
    <script>
        // Password protection logic
        const PASSWORD = 'vupopfutureinvestor';
        function checkPassword(event) {
            event.preventDefault();
            const input = document.getElementById('passwordInput').value;
            if (input === PASSWORD) {
                document.getElementById('passwordOverlay').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                var logo = document.getElementById('vupopLogo');
                if (logo) logo.style.display = 'block';
                loadRealData();
            } else {
                document.getElementById('passwordError').style.display = 'block';
            }
            return false;
        }

        // Real Vupop data from your financial model
        const realVupopData = {
            mauTargets: [50000, 150000, 313000, 500000, 750000],
            actualRevenue: {
                b2c: [89640, 268920, 1497240, 3500000, 6750000],
                b2b: [275000, 1100000, 3200000, 6500000, 10800000],
                total: [364640, 1368920, 4697240, 10000000, 17550000]
            },
            costs: {
                cogs: [180000, 550000, 1400000, 2800000, 4400000],
                opex: [950000, 1900000, 3200000, 5200000, 7500000]
            },
            margins: {
                gross: [184640, 818920, 3297240, 7200000, 13150000],
                ebitda: [-765360, -1081080, 97240, 2000000, 5650000]
            }
        };

        function loadRealData() {
            // Populate key metrics
            document.getElementById('projectedRevenue').textContent = `£${formatNumber(realVupopData.actualRevenue.total[3])}`;
            document.getElementById('profitPotential').textContent = `£${formatNumber(realVupopData.margins.ebitda[3])}`;
            document.getElementById('growthRate').textContent = 'N/A';
            document.getElementById('exitValuation').querySelector('.metric-value').textContent = `£${formatNumber(realVupopData.actualRevenue.total[3] * 10)}`;

            // Populate financial table
            const years = [1,2,3,4,5];
            let tableBody = document.getElementById('projectionsTable');
            tableBody.innerHTML = '';
            for (let i = 0; i < 5; i++) {
                let row = document.createElement('tr');
                row.innerHTML = `
                    <td>Year ${years[i]}</td>
                    <td>£${formatNumber(realVupopData.actualRevenue.total[i])}</td>
                    <td>£${formatNumber(realVupopData.margins.ebitda[i])}</td>
                    <td>N/A</td>
                `;
                tableBody.appendChild(row);
            }
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('en-GB', { maximumFractionDigits: 0 }).format(num);
        }

        // Prepare structure for year-by-year calculations and scenario analysis
        function getYearlyInputs() {
            return {
                marketingSpend: [
                    parseFloat(document.getElementById('marketingSpend1').value) || 0,
                    parseFloat(document.getElementById('marketingSpend2').value) || 0,
                    parseFloat(document.getElementById('marketingSpend3').value) || 0,
                    parseFloat(document.getElementById('marketingSpend4').value) || 0,
                    parseFloat(document.getElementById('marketingSpend5').value) || 0
                ],
                contentRate: parseFloat(document.getElementById('contentRate').value) || 0,
                scenarioProbs: [
                    parseFloat(document.getElementById('probConservative').value) || 0,
                    parseFloat(document.getElementById('probBase').value) || 0,
                    parseFloat(document.getElementById('probOptimistic').value) || 0
                ]
            };
        }

        // Smooth scrolling
        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Add tooltips to inputs
        document.querySelectorAll('.input-group').forEach(group => {
            const label = group.querySelector('label');
            const input = group.querySelector('input');
            if (label && input) {
                const tooltip = document.createElement('div');
                tooltip.className = 'tooltip';
                tooltip.innerHTML = `
                    <span class="tooltip-text">${input.getAttribute('data-tooltip') || 'Enter a value'}</span>
                    ${label.outerHTML}
                `;
                group.replaceChild(tooltip, label);
            }
        });

        // Chart.js line graph for KPIs
        let kpiLineChart;
        const kpiColors = {
            exit: '#fff700',
            revenue: '#00e6ff',
            mau: '#bada55',
            growth: '#ffb300'
        };
        let kpiVisibility = { exit: true, revenue: true, mau: true, growth: true };
        function updateKpiLineChart(data) {
            const ctx = document.getElementById('kpiLineChart').getContext('2d');
            if (kpiLineChart) kpiLineChart.destroy();
            kpiLineChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [
                        { label: 'Exit Potential (£M)', data: data.exit, borderColor: '#fff700', yAxisID: 'y' },
                        { label: 'Revenue (£M)', data: data.revenue, borderColor: '#00e6ff', yAxisID: 'y' },
                        { label: 'OPEX (£M)', data: data.opex, borderColor: '#ff6384', yAxisID: 'y' },
                        { label: 'MAU (K)', data: data.mau, borderColor: '#bada55', yAxisID: 'y2' }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { type: 'linear', position: 'left', title: { display: true, text: 'Value (£M)' } },
                        y2: { type: 'linear', position: 'right', title: { display: true, text: 'Users (K)' }, grid: { drawOnChartArea: false } }
                    }
                }
            });
            // Custom legend with toggles
            const legend = document.getElementById('kpiLegend');
            legend.innerHTML = '';
            [
                { key: 'exit', label: 'Exit Potential', color: kpiColors.exit },
                { key: 'revenue', label: 'Revenue', color: kpiColors.revenue },
                { key: 'mau', label: 'MAU', color: kpiColors.mau },
                { key: 'growth', label: 'Growth Rate', color: kpiColors.growth }
            ].forEach(item => {
                const el = document.createElement('span');
                el.className = 'kpi-legend-item' + (kpiVisibility[item.key] ? '' : ' inactive');
                el.innerHTML = `<span class="kpi-legend-color" style="background:${item.color}"></span>${item.label}`;
                el.onclick = () => {
                    kpiVisibility[item.key] = !kpiVisibility[item.key];
                    updateKpiLineChart(data);
                };
                legend.appendChild(el);
            });
        }
        // Example data (replace with real calculations)
        const kpiData = {
            labels: ['Year 1','Year 2','Year 3','Year 4','Year 5'],
            exit: [16, 80, 100, 140, 200],
            revenue: [1.5, 4.5, 7.5, 12, 18],
            mau: [50, 150, 313, 500, 800],
            growth: [400, 200, 108, 60, 40]
        };
        updateKpiLineChart(kpiData);

        document.getElementById('adjustAssumptionsBtn').addEventListener('click', () => {
            document.getElementById('assumptionsPanel').style.display = 'flex'; // Use flex to show
        });

        document.getElementById('closeAssumptions').addEventListener('click', () => {
            document.getElementById('assumptionsPanel').style.display = 'none';
        });

        document.getElementById('updateButton').addEventListener('click', () => {
            calculateProjections(); // Recalculate everything
            document.getElementById('assumptionsPanel').style.display = 'none'; // Hide panel
        });

        function calculateProjections() {
            // --- 1. Read All Inputs ---
            const inputs = {
                startingMAU: parseInt(document.getElementById('startingMAU').value) || 0,
                mauTargets: [
                    parseInt(document.getElementById('mau1').value) || 0,
                    parseInt(document.getElementById('mau2').value) || 0,
                    parseInt(document.getElementById('mau3').value) || 0,
                    parseInt(document.getElementById('mau4').value) || 0,
                    parseInt(document.getElementById('mau5').value) || 0
                ],
                premiumPrice: parseFloat(document.getElementById('premiumPrice').value) || 0,
                adoptionRate: parseFloat(document.getElementById('adoptionRate').value) || 0,
                adRevenue: parseFloat(document.getElementById('adRevenue').value) || 0,
                affiliateRate: parseFloat(document.getElementById('affiliateRate').value) || 0,
                socialTierPrice: parseFloat(document.getElementById('socialTierPrice').value) || 0,
                broadcastTierPrice: parseFloat(document.getElementById('broadcastTierPrice').value) || 0,
                broadcastPlusTierPrice: parseFloat(document.getElementById('broadcastPlusTierPrice').value) || 0,
                usageFee: parseFloat(document.getElementById('usageFee').value) || 0,
                scenarioProbs: [
                    parseFloat(document.getElementById('probConservative').value) || 0,
                    parseFloat(document.getElementById('probBase').value) || 0,
                    parseFloat(document.getElementById('probOptimistic').value) || 0
                ]
            };

            // --- 2. Perform Year-by-Year Calculations ---
            const yearlyResults = [];
            const exitValuations = [];
            const revenueStreams = [];
            const mauValues = [];
            const opexValues = [];

            // Static assumptions from model
            const socialCustomers = [3, 5, 15, 25, 40];
            const broadcastCustomers = [3, 8, 15, 25, 35];
            const broadcastPlusCustomers = [1, 3, 5, 8, 10];
            const usageSeconds = [2900, 25000, 100000, 250000, 450000];
            const opex = [950000, 1900000, 3200000, 5200000, 7500000];
            const cogsPerc = [0.49, 0.40, 0.30, 0.28, 0.25];

            for (let i = 0; i < 5; i++) {
                const mau = inputs.mauTargets[i];
                // Revenue
                const premiumRev = mau * (inputs.adoptionRate / 100) * inputs.premiumPrice * 12;
                const adRev = i >= 2 ? mau * inputs.adRevenue * 12 : 0;
                const socialRev = socialCustomers[i] * inputs.socialTierPrice * 12;
                const broadcastRev = broadcastCustomers[i] * inputs.broadcastTierPrice * 12;
                const broadcastPlusRev = broadcastPlusCustomers[i] * inputs.broadcastPlusTierPrice * 12;
                const usageRev = usageSeconds[i] * inputs.usageFee;
                const totalRevenue = premiumRev + adRev + socialRev + broadcastRev + broadcastPlusRev + usageRev;
                revenueStreams.push(totalRevenue / 1_000_000); // For chart in millions

                // Costs & Profit
                const totalCogs = totalRevenue * cogsPerc[i];
                const grossProfit = totalRevenue - totalCogs;
                const ebitda = grossProfit - opex[i];
                opexValues.push(opex[i] / 1_000_000); // Store OPEX in millions

                // Valuation (10x current year's revenue)
                const valuation = totalRevenue * 10;
                exitValuations.push(valuation / 1_000_000); // For chart in millions
                revenueStreams.push(totalRevenue / 1_000_000); // In millions
                mauValues.push(inputs.mauTargets[i] / 1000); // In thousands
                opexValues.push(opex[i] / 1_000_000); // In millions

                // Store the full, unformatted numbers for later use
                yearlyResults.push({ totalRevenue, ebitda, valuation, cac: ebitda });
            }

            // --- 3. Scenario & Risk-Adjusted Calculation ---
            const baseValuationY4 = yearlyResults[3].valuation;
            const consValuationY4 = baseValuationY4 * 0.8;
            const optValuationY4 = baseValuationY4 * 1.3;
            const riskAdjustedValuation = (consValuationY4 * (inputs.scenarioProbs[0]/100)) +
                                        (baseValuationY4 * (inputs.scenarioProbs[1]/100)) +
                                        (optValuationY4 * (inputs.scenarioProbs[2]/100));

            // --- 4. Update Dashboard UI ---
            // Update Key Metric Cards using consistent data
            document.getElementById('exitPotential').textContent = `£${(riskAdjustedValuation / 1_000_000).toFixed(1)}M`;
            document.getElementById('annualRevenue').textContent = `£${(yearlyResults[3].totalRevenue / 1_000_000).toFixed(1)}M`;
            document.getElementById('targetMau').textContent = `${(inputs.mauTargets[3] / 1000).toFixed(0)}K`;
            document.getElementById('kpi-cac').textContent = `£${yearlyResults[3].cac.toFixed(2)}`;

            // Update the KPI Line Chart
            const kpiData = {
                labels: ['Y1', 'Y2', 'Y3', 'Y4', 'Y5'],
                exit: exitValuations, // This is the base-case valuation timeline
                revenue: revenueStreams,
                mau: mauValues,
                opex: opexValues
            };
            updateKpiLineChart(kpiData);
        }

        // Run calculations on page load
        window.onload = () => {
            // We need to handle the password overlay first
            const passwordForm = document.getElementById('passwordForm');
            if (passwordForm) {
                passwordForm.addEventListener('submit', (event) => {
                    if (checkPassword(event)) {
                         calculateProjections();
                    }
                });
            }
        };

        // Add event listeners to all inputs to recalculate on change
        document.querySelectorAll('#assumptionsInputs input').forEach(input => {
            input.addEventListener('change', calculateProjections);
        });
    </script>
</body>
</html>
