<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Vupop Financial Model - Interactive financial analysis and projection tool">
    <meta name="theme-color" content="#000000">
    <title>Vupop Financial Model - Interactive</title>
    <style>
        :root {
            --yellow: #fff700;
            --black: #111111;
            --white: #fff;
            --gray: #222;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--black);
            color: var(--white);
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background: var(--black);
            border-radius: 24px;
            padding: 35px 20px 20px 20px;
            text-align: center;
            margin-bottom: 35px;
            border: 2px solid var(--yellow);
            position: relative;
        }
        .header .logo {
            display: block;
            margin: 0 auto 20px auto;
            max-width: 220px;
            height: auto;
        }
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: var(--yellow);
            font-weight: 900;
            letter-spacing: 2px;
        }
        .header p {
            color: var(--white);
            font-size: 1.1em;
        }
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        .controls-panel, .results-panel {
            background: var(--gray);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            border: 2px solid var(--yellow);
        }
        .section-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 20px;
            color: var(--yellow);
            border-bottom: 2px solid var(--yellow);
            padding-bottom: 10px;
        }
        .input-group {
            margin-bottom: 20px;
        }
        .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--yellow);
        }
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--yellow);
            border-radius: 10px;
            font-size: 16px;
            background: var(--black);
            color: var(--white);
            transition: all 0.3s ease;
        }
        .input-group input:focus {
            border-color: var(--yellow);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 247, 0, 0.2);
        }
        .button {
            background: var(--yellow);
            color: var(--black);
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin: 12px 0;
            position: relative;
            overflow: hidden;
            letter-spacing: 1px;
        }
        .button:hover {
            background: var(--white);
            color: var(--black);
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .metric-card {
            background: var(--black);
            border: 2px solid var(--yellow);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            color: var(--yellow);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .metric-card h3 {
            font-size: 1em;
            color: var(--yellow);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .metric-value {
            font-size: 2.2em;
            font-weight: bold;
            color: var(--white);
        }
        .metric-subtitle {
            font-size: 0.8em;
            color: var(--yellow);
            margin-top: 5px;
        }
        .chart-container {
            background: var(--black);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            border: 2px solid var(--yellow);
        }
        .financial-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 25px 0;
            background: var(--black);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            color: var(--white);
        }
        .financial-table th {
            background: var(--yellow);
            color: var(--black);
            padding: 18px;
            text-align: left;
            font-weight: 700;
            font-size: 0.95em;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        .financial-table td {
            padding: 16px 18px;
            border-bottom: 1px solid var(--yellow);
            font-size: 0.95em;
            transition: all 0.3s ease;
        }
        .financial-table tr:hover td {
            background: #222200;
        }
        .financial-table tr:last-child td {
            border-bottom: none;
        }
        .exit-highlight {
            background: var(--yellow);
            color: var(--black);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
            font-weight: 700;
        }
        .exit-highlight h3 {
            margin: 0 0 10px 0;
            font-size: 1.5em;
            color: var(--black);
        }
        @media (max-width: 900px) {
            .dashboard {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }
        /* Password Overlay */
        .password-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.98);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .password-box {
            background: var(--black);
            border: 2px solid var(--yellow);
            border-radius: 16px;
            padding: 40px 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.6);
            text-align: center;
            min-width: 320px;
        }
        .password-box label {
            color: var(--yellow);
            font-size: 1.2em;
            font-weight: 700;
            margin-bottom: 16px;
            display: block;
        }
        .password-box input[type='password'] {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--yellow);
            border-radius: 8px;
            font-size: 1.1em;
            background: var(--black);
            color: var(--white);
            margin-bottom: 18px;
        }
        .password-box button {
            background: var(--yellow);
            color: var(--black);
            border: none;
            padding: 10px 24px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: background 0.2s;
        }
        .password-box button:hover {
            background: var(--white);
        }
        .password-error {
            color: #ff3333;
            margin-bottom: 10px;
            font-weight: 600;
        }
        .scenario-section {
            background: var(--gray);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            border: 2px solid var(--yellow);
        }
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .kpi-card {
            background: var(--black);
            border: 2px solid var(--yellow);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            color: var(--yellow);
        }
        .kpi-card h4 {
            color: var(--yellow);
            margin-bottom: 10px;
            font-size: 0.9em;
            text-transform: uppercase;
        }
        .kpi-value {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--white);
        }
    </style>
</head>
<body>
    <div id="passwordOverlay" class="password-overlay">
        <form class="password-box" onsubmit="return checkPassword(event)">
            <label for="passwordInput">Enter Password to Access</label>
            <input type="password" id="passwordInput" autocomplete="off" autofocus required />
            <div id="passwordError" class="password-error" style="display:none;">Incorrect password. Please try again.</div>
            <button type="submit">Unlock</button>
        </form>
    </div>
    <div class="container" id="mainContent" style="display:none;">
        <header class="header fade-in">
            <!-- Logo placeholder -->
            <img src="logo.png" alt="Vupop Logo" class="logo" id="vupopLogo" style="display:none;" />
            <h1>Vupop Financial Model</h1>
            <p>Interactive Financial Analysis Dashboard</p>
        </header>
        <div class="dashboard">
            <div class="controls-panel fade-in">
                <h2 class="section-title">Key Assumptions</h2>
                <div class="input-group">
                    <label for="startingMAU">Starting MAU</label>
                    <input type="number" id="startingMAU" value="1000" min="0">
                </div>
                <div class="input-group">
                    <label for="mau1">Year 1 Target MAU</label>
                    <input type="number" id="mau1" value="50000" min="0">
                </div>
                <div class="input-group">
                    <label for="mau2">Year 2 Target MAU</label>
                    <input type="number" id="mau2" value="150000" min="0">
                </div>
                <div class="input-group">
                    <label for="mau3">Year 3 Target MAU</label>
                    <input type="number" id="mau3" value="313000" min="0">
                </div>
                <div class="input-group">
                    <label for="mau4">Year 4 Target MAU</label>
                    <input type="number" id="mau4" value="500000" min="0">
                </div>
                <div class="input-group">
                    <label for="mau5">Year 5 Target MAU</label>
                    <input type="number" id="mau5" value="750000" min="0">
                </div>
                <div class="input-group">
                    <label for="premiumPrice">Premium Subscription Price (£/month)</label>
                    <input type="number" id="premiumPrice" value="0.99" step="0.01" min="0">
                </div>
                <div class="input-group">
                    <label for="adoptionRate">Premium Adoption Rate (%)</label>
                    <input type="number" id="adoptionRate" value="10" step="1" min="0" max="100">
                </div>
                <div class="input-group">
                    <label for="adRevenue">Ad Revenue per User (£/month)</label>
                    <input type="number" id="adRevenue" value="0.45" step="0.01" min="0">
                </div>
                <div class="input-group">
                    <label for="affiliateRate">Affiliate Commission Rate (%)</label>
                    <input type="number" id="affiliateRate" value="5.00" step="0.01" min="0" max="100">
                </div>
                <div class="input-group">
                    <label for="socialTierPrice">Social Tier Price (£/month)</label>
                    <input type="number" id="socialTierPrice" value="999" step="1" min="0">
                </div>
                <div class="input-group">
                    <label for="broadcastTierPrice">Broadcast Tier Price (£/month)</label>
                    <input type="number" id="broadcastTierPrice" value="3499" step="1" min="0">
                </div>
                <div class="input-group">
                    <label for="broadcastPlusTierPrice">Broadcast+ Tier Price (£/month)</label>
                    <input type="number" id="broadcastPlusTierPrice" value="4997" step="1" min="0">
                </div>
                <div class="input-group">
                    <label for="usageFee">Usage Fee per Second (£)</label>
                    <input type="number" id="usageFee" value="12" step="1" min="0">
                </div>
                <div class="input-group">
                    <label for="marketingSpend1">Year 1 Marketing Spend (£)</label>
                    <input type="number" id="marketingSpend1" value="200000" min="0">
                </div>
                <div class="input-group">
                    <label for="marketingSpend2">Year 2 Marketing Spend (£)</label>
                    <input type="number" id="marketingSpend2" value="400000" min="0">
                </div>
                <div class="input-group">
                    <label for="marketingSpend3">Year 3 Marketing Spend (£)</label>
                    <input type="number" id="marketingSpend3" value="600000" min="0">
                </div>
                <div class="input-group">
                    <label for="marketingSpend4">Year 4 Marketing Spend (£)</label>
                    <input type="number" id="marketingSpend4" value="800000" min="0">
                </div>
                <div class="input-group">
                    <label for="marketingSpend5">Year 5 Marketing Spend (£)</label>
                    <input type="number" id="marketingSpend5" value="1000000" min="0">
                </div>
                <div class="input-group">
                    <label for="contentRate">Content Creation Rate per User (clips/day)</label>
                    <input type="number" id="contentRate" value="0.01" step="0.001" min="0">
                </div>
                <div class="input-group">
                    <label for="probConservative">Conservative Scenario Probability (%)</label>
                    <input type="number" id="probConservative" value="30" min="0" max="100">
                </div>
                <div class="input-group">
                    <label for="probBase">Base Case Scenario Probability (%)</label>
                    <input type="number" id="probBase" value="50" min="0" max="100">
                </div>
                <div class="input-group">
                    <label for="probOptimistic">Optimistic Scenario Probability (%)</label>
                    <input type="number" id="probOptimistic" value="20" min="0" max="100">
                </div>
                <button class="button" onclick="calculateProjections()">Update Projections</button>
            </div>
            <div class="results-panel fade-in">
                <h2 class="section-title">Key Metrics</h2>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <h3>Projected Revenue</h3>
                        <div class="metric-value" id="projectedRevenue">$0</div>
                        <div class="metric-subtitle">5 Year Projection</div>
                    </div>
                    <div class="metric-card">
                        <h3>Profit Potential</h3>
                        <div class="metric-value" id="profitPotential">$0</div>
                        <div class="metric-subtitle">5 Year Projection</div>
                    </div>
                    <div class="metric-card">
                        <h3>Growth Rate</h3>
                        <div class="metric-value" id="growthRate">0%</div>
                        <div class="metric-subtitle">Annual</div>
                    </div>
                </div>
                <div class="chart-container">
                    <h3 class="section-title">Financial Projections</h3>
                    <div class="table-responsive">
                        <table class="financial-table">
                            <thead>
                                <tr>
                                    <th>Year</th>
                                    <th>Revenue</th>
                                    <th>Profit</th>
                                    <th>Growth</th>
                                </tr>
                            </thead>
                            <tbody id="projectionsTable">
                                <!-- Table content will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="exit-highlight" id="exitValuation">
                    <h3>Potential Exit Valuation</h3>
                    <div class="metric-value">$0</div>
                    <div class="metric-subtitle">Based on 5x Revenue Multiple</div>
                </div>
            </div>
        </div>
        <div class="scenario-section">
            <h2 class="section-title">Exit Valuation Scenarios</h2>
            <table class="financial-table">
                <thead>
                    <tr>
                        <th>Scenario</th>
                        <th>Year 4 Revenue</th>
                        <th>10x Valuation</th>
                        <th>ROI Multiple</th>
                        <th>Probability</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Conservative</strong></td>
                        <td>£8,000,000</td>
                        <td>£80,000,000</td>
                        <td>17.8x</td>
                        <td>30%</td>
                    </tr>
                    <tr style="background: #222200; color: var(--yellow);">
                        <td><strong>Base Case</strong></td>
                        <td>£10,000,000</td>
                        <td>£100,000,000</td>
                        <td>22.2x</td>
                        <td>50%</td>
                    </tr>
                    <tr>
                        <td><strong>Optimistic</strong></td>
                        <td>£13,000,000</td>
                        <td>£130,000,000</td>
                        <td>28.9x</td>
                        <td>20%</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="scenario-section">
            <h2 class="section-title">Key Performance Indicators</h2>
            <div class="kpi-grid">
                <div class="kpi-card">
                    <h4>Customer Acquisition Cost</h4>
                    <div class="kpi-value">£4.00</div>
                </div>
                <div class="kpi-card">
                    <h4>Average Revenue Per User</h4>
                    <div class="kpi-value">£1.67</div>
                </div>
                <div class="kpi-card">
                    <h4>B2B Customer LTV</h4>
                    <div class="kpi-value">£110K</div>
                </div>
                <div class="kpi-card">
                    <h4>LTV/CAC Ratio</h4>
                    <div class="kpi-value">49:1</div>
                </div>
                <div class="kpi-card">
                    <h4>Monthly Churn Rate</h4>
                    <div class="kpi-value">8%</div>
                </div>
                <div class="kpi-card">
                    <h4>Content Upload Rate</h4>
                    <div class="kpi-value">5K/day</div>
                </div>
            </div>
        </div>
        <div class="scenario-section">
            <h2 class="section-title">User Growth Model</h2>
            <table class="financial-table">
                <thead>
                    <tr>
                        <th>Timeline</th>
                        <th>Month</th>
                        <th>MAU Target</th>
                        <th>Growth Rate</th>
                        <th>Key Milestones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Launch</strong></td>
                        <td>Month 1-6</td>
                        <td>1K - 15K</td>
                        <td>150%</td>
                        <td>Product launch, broadcaster partnerships</td>
                    </tr>
                    <tr>
                        <td><strong>Growth</strong></td>
                        <td>Month 12</td>
                        <td>50K</td>
                        <td>35%</td>
                        <td>Revenue model validation</td>
                    </tr>
                    <tr>
                        <td><strong>Scale</strong></td>
                        <td>Month 18</td>
                        <td>100K</td>
                        <td>25%</td>
                        <td>Series A funding (£3.5M)</td>
                    </tr>
                    <tr>
                        <td><strong>Market Leader</strong></td>
                        <td>Month 36</td>
                        <td>313K</td>
                        <td>8%</td>
                        <td>International expansion</td>
                    </tr>
                    <tr style="background: #222200; color: var(--yellow);">
                        <td><strong>EXIT WINDOW</strong></td>
                        <td>Month 48</td>
                        <td>500K</td>
                        <td>6%</td>
                        <td>£100M Exit @ 10x Revenue</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <script>
        // Password protection logic
        const PASSWORD = 'vupopfutureinvestor';
        function checkPassword(event) {
            event.preventDefault();
            const input = document.getElementById('passwordInput').value;
            if (input === PASSWORD) {
                document.getElementById('passwordOverlay').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                var logo = document.getElementById('vupopLogo');
                if (logo) logo.style.display = 'block';
                loadRealData();
            } else {
                document.getElementById('passwordError').style.display = 'block';
            }
            return false;
        }

        // Real Vupop data from your financial model
        const realVupopData = {
            mauTargets: [50000, 150000, 313000, 500000, 750000],
            actualRevenue: {
                b2c: [89640, 268920, 1497240, 3500000, 6750000],
                b2b: [275000, 1100000, 3200000, 6500000, 10800000],
                total: [364640, 1368920, 4697240, 10000000, 17550000]
            },
            costs: {
                cogs: [180000, 550000, 1400000, 2800000, 4400000],
                opex: [950000, 1900000, 3200000, 5200000, 7500000]
            },
            margins: {
                gross: [184640, 818920, 3297240, 7200000, 13150000],
                ebitda: [-765360, -1081080, 97240, 2000000, 5650000]
            }
        };

        function loadRealData() {
            // Populate key metrics
            document.getElementById('projectedRevenue').textContent = `£${formatNumber(realVupopData.actualRevenue.total[3])}`;
            document.getElementById('profitPotential').textContent = `£${formatNumber(realVupopData.margins.ebitda[3])}`;
            document.getElementById('growthRate').textContent = 'N/A';
            document.getElementById('exitValuation').querySelector('.metric-value').textContent = `£${formatNumber(realVupopData.actualRevenue.total[3] * 10)}`;

            // Populate financial table
            const years = [1,2,3,4,5];
            let tableBody = document.getElementById('projectionsTable');
            tableBody.innerHTML = '';
            for (let i = 0; i < 5; i++) {
                let row = document.createElement('tr');
                row.innerHTML = `
                    <td>Year ${years[i]}</td>
                    <td>£${formatNumber(realVupopData.actualRevenue.total[i])}</td>
                    <td>£${formatNumber(realVupopData.margins.ebitda[i])}</td>
                    <td>N/A</td>
                `;
                tableBody.appendChild(row);
            }
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('en-GB', { maximumFractionDigits: 0 }).format(num);
        }

        // Add input validation
        function validateInput(input) {
            const value = parseFloat(input.value);
            const min = parseFloat(input.min);
            const max = parseFloat(input.max);
            if (value < min) input.value = min;
            if (value > max) input.value = max;
        }
        document.getElementById('revenue').addEventListener('change', function() { validateInput(this); });
        document.getElementById('growth').addEventListener('change', function() { validateInput(this); });
        document.getElementById('margin').addEventListener('change', function() { validateInput(this); });
        function calculateProjections() {
            // Read all input values
            const startingMAU = parseInt(document.getElementById('startingMAU').value) || 0;
            const mauTargets = [
                parseInt(document.getElementById('mau1').value) || 0,
                parseInt(document.getElementById('mau2').value) || 0,
                parseInt(document.getElementById('mau3').value) || 0,
                parseInt(document.getElementById('mau4').value) || 0,
                parseInt(document.getElementById('mau5').value) || 0
            ];
            const premiumPrice = parseFloat(document.getElementById('premiumPrice').value) || 0;
            const adoptionRate = parseFloat(document.getElementById('adoptionRate').value) || 0;
            const adRevenue = parseFloat(document.getElementById('adRevenue').value) || 0;
            const affiliateRate = parseFloat(document.getElementById('affiliateRate').value) || 0;
            const socialTierPrice = parseFloat(document.getElementById('socialTierPrice').value) || 0;
            const broadcastTierPrice = parseFloat(document.getElementById('broadcastTierPrice').value) || 0;
            const broadcastPlusTierPrice = parseFloat(document.getElementById('broadcastPlusTierPrice').value) || 0;
            const usageFee = parseFloat(document.getElementById('usageFee').value) || 0;
            const marketingSpend = [
                parseFloat(document.getElementById('marketingSpend1').value) || 0,
                parseFloat(document.getElementById('marketingSpend2').value) || 0,
                parseFloat(document.getElementById('marketingSpend3').value) || 0,
                parseFloat(document.getElementById('marketingSpend4').value) || 0,
                parseFloat(document.getElementById('marketingSpend5').value) || 0
            ];
            const contentRate = parseFloat(document.getElementById('contentRate').value) || 0;
            const scenarioProbs = [
                parseFloat(document.getElementById('probConservative').value) || 0,
                parseFloat(document.getElementById('probBase').value) || 0,
                parseFloat(document.getElementById('probOptimistic').value) || 0
            ];

            // B2B customer assumptions
            const socialCustomers = [3, 5, 15, 25, 40];
            const broadcastCustomers = [3, 8, 15, 25, 35];
            const broadcastPlusCustomers = [1, 3, 5, 8, 10];
            const usageSeconds = [2900, 25000, 100000, 250000, 450000];

            // COGS % by year
            const cogsPerc = [0.49, 0.40, 0.30, 0.28, 0.25];
            // OpEx by year
            const opex = [950000, 1900000, 3200000, 5200000, 7500000];
            // Churn by year
            const churnRates = [0.15, 0.12, 0.10, 0.08, 0.07];

            // --- Year-by-year calculations ---
            let results = [];
            for (let i = 0; i < 5; i++) {
                // Premium Revenue
                const premiumRevenue = mauTargets[i] * (adoptionRate/100) * premiumPrice * 12;
                // Ad Revenue (only from Year 3)
                const adRev = i >= 2 ? mauTargets[i] * adRevenue * 12 : 0;
                // Affiliate Revenue (simple exponential growth, base £10K in Y1)
                const affiliateRev = 10000 * Math.pow(2, i);
                // B2B Revenue
                const socialRev = socialCustomers[i] * socialTierPrice * 12;
                const broadcastRev = broadcastCustomers[i] * broadcastTierPrice * 12;
                const broadcastPlusRev = broadcastPlusCustomers[i] * broadcastPlusTierPrice * 12;
                // Usage Revenue
                const usageRev = usageSeconds[i] * usageFee;
                // Total Revenue
                const totalRevenue = premiumRevenue + adRev + affiliateRev + socialRev + broadcastRev + broadcastPlusRev + usageRev;
                // COGS
                const cogs = totalRevenue * cogsPerc[i];
                // Gross Profit
                const grossProfit = totalRevenue - cogs;
                // Gross Margin %
                const grossMargin = totalRevenue > 0 ? (grossProfit / totalRevenue) * 100 : 0;
                // EBITDA
                const ebitda = grossProfit - opex[i];
                // EBITDA Margin %
                const ebitdaMargin = totalRevenue > 0 ? (ebitda / totalRevenue) * 100 : 0;
                // CAC (Marketing Spend / Net New MAU)
                const newUsers = i === 0 ? mauTargets[0] - startingMAU : mauTargets[i] - mauTargets[i-1];
                const cac = newUsers > 0 ? marketingSpend[i] / newUsers : 0;
                // ARPU (monthly)
                const arpu = mauTargets[i] > 0 ? totalRevenue / mauTargets[i] / 12 : 0;
                // B2B LTV (average B2B revenue per customer * 24 months)
                const totalB2BCustomers = socialCustomers[i] + broadcastCustomers[i] + broadcastPlusCustomers[i];
                const avgB2BRevenue = totalB2BCustomers > 0 ? (socialRev + broadcastRev + broadcastPlusRev) / totalB2BCustomers : 0;
                const b2bLTV = avgB2BRevenue * 24;
                // LTV/CAC
                const ltvCac = cac > 0 ? b2bLTV / cac : 0;
                // Retention
                const retention = 1 - churnRates[i];
                // Upload Rate (clips/day)
                const uploadRate = Math.round(mauTargets[i] * contentRate);
                results.push({
                    premiumRevenue, adRev, affiliateRev, socialRev, broadcastRev, broadcastPlusRev, usageRev, totalRevenue,
                    cogs, grossProfit, grossMargin, ebitda, ebitdaMargin, cac, arpu, b2bLTV, ltvCac, retention, uploadRate
                });
            }

            // --- Update Key Metrics (Year 4) ---
            document.getElementById('projectedRevenue').textContent = `£${formatNumber(results[3].totalRevenue)}`;
            document.getElementById('profitPotential').textContent = `£${formatNumber(results[3].ebitda)}`;
            document.getElementById('growthRate').textContent = mauTargets[2] > 0 ? `${(((mauTargets[3] - mauTargets[2]) / mauTargets[2]) * 100).toFixed(1)}%` : '0%';
            document.getElementById('exitValuation').querySelector('.metric-value').textContent = `£${formatNumber(results[3].totalRevenue * 10)}`;

            // --- Update Financial Projections Table ---
            let tableBody = document.getElementById('projectionsTable');
            tableBody.innerHTML = '';
            for (let i = 0; i < 5; i++) {
                let row = document.createElement('tr');
                row.innerHTML = `
                    <td>Year ${i+1}</td>
                    <td>£${formatNumber(results[i].totalRevenue)}</td>
                    <td>£${formatNumber(results[i].ebitda)}</td>
                    <td>${mauTargets[i] > 0 && i > 0 ? (((mauTargets[i] - mauTargets[i-1]) / mauTargets[i-1]) * 100).toFixed(1) : '0'}%</td>
                `;
                tableBody.appendChild(row);
            }

            // --- Update Dynamic KPIs (Year 4) ---
            document.querySelector('.kpi-card:nth-child(1) .kpi-value').textContent = `£${results[3].cac.toFixed(2)}`;
            document.querySelector('.kpi-card:nth-child(2) .kpi-value').textContent = `£${results[3].arpu.toFixed(2)}`;
            document.querySelector('.kpi-card:nth-child(3) .kpi-value').textContent = `£${Math.round(results[3].b2bLTV/1000)}K`;
            document.querySelector('.kpi-card:nth-child(4) .kpi-value').textContent = results[3].ltvCac > 0 ? `${results[3].ltvCac.toFixed(1)}:1` : 'N/A';
            document.querySelector('.kpi-card:nth-child(5) .kpi-value').textContent = `${(results[3].retention*100).toFixed(0)}%`;
            document.querySelector('.kpi-card:nth-child(6) .kpi-value').textContent = `${results[3].uploadRate.toLocaleString()}/day`;

            // --- Scenario Analysis ---
            // Base: Year 4 Revenue, Conservative: -20%, Optimistic: +30%
            const baseRev = results[3].totalRevenue;
            const consRev = baseRev * 0.8;
            const optRev = baseRev * 1.3;
            const baseVal = baseRev * 10;
            const consVal = consRev * 10;
            const optVal = optRev * 10;
            // Update scenario table (if you want to make it dynamic)
            const scenarioRows = document.querySelectorAll('.scenario-section table tbody tr');
            if (scenarioRows.length >= 3) {
                scenarioRows[0].children[1].textContent = `£${formatNumber(consRev)}`;
                scenarioRows[0].children[2].textContent = `£${formatNumber(consVal)}`;
                scenarioRows[0].children[3].textContent = (consVal/4500000).toFixed(1) + 'x';
                scenarioRows[1].children[1].textContent = `£${formatNumber(baseRev)}`;
                scenarioRows[1].children[2].textContent = `£${formatNumber(baseVal)}`;
                scenarioRows[1].children[3].textContent = (baseVal/4500000).toFixed(1) + 'x';
                scenarioRows[2].children[1].textContent = `£${formatNumber(optRev)}`;
                scenarioRows[2].children[2].textContent = `£${formatNumber(optVal)}`;
                scenarioRows[2].children[3].textContent = (optVal/4500000).toFixed(1) + 'x';
            }
            // Risk-adjusted expected value
            const expectedVal = consVal * (scenarioProbs[0]/100) + baseVal * (scenarioProbs[1]/100) + optVal * (scenarioProbs[2]/100);
            // Optionally display this somewhere in the UI
            // console.log('Risk-adjusted expected value:', expectedVal);
        }
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    calculateProjections();
                }
            });
            input.addEventListener('change', calculateProjections);
        });

        // Prepare structure for year-by-year calculations and scenario analysis
        function getYearlyInputs() {
            return {
                marketingSpend: [
                    parseFloat(document.getElementById('marketingSpend1').value) || 0,
                    parseFloat(document.getElementById('marketingSpend2').value) || 0,
                    parseFloat(document.getElementById('marketingSpend3').value) || 0,
                    parseFloat(document.getElementById('marketingSpend4').value) || 0,
                    parseFloat(document.getElementById('marketingSpend5').value) || 0
                ],
                contentRate: parseFloat(document.getElementById('contentRate').value) || 0,
                scenarioProbs: [
                    parseFloat(document.getElementById('probConservative').value) || 0,
                    parseFloat(document.getElementById('probBase').value) || 0,
                    parseFloat(document.getElementById('probOptimistic').value) || 0
                ]
            };
        }
    </script>
</body>
</html>
